<div>
  <label for="token">Github API Token</label>
  <input id="token" type="text" />
</div>

<div>
  <label for="token">Owner</label>
  <input id="owner" type="text" />
</div>

<div>
  <label for="repo">Repository</label>
  <input id="repo" type="text" />
</div>

<button id="importButton">Import</button>
<button id="exportButton">Export</button>
<div id="errors"></div>

<script>
  const tokenField = document.getElementById("token");
  const ownerField = document.getElementById("owner");
  const repoField = document.getElementById("repo");
  const importButton = document.getElementById("importButton");
  const exportButton = document.getElementById("exportButton");
  const errorText = document.getElementById("errors");

  // TODO: hard-code this if you need a default
  tokenField.value = "";
  ownerField.value = "";
  repoField.value = "";

  importButton.onclick = async () => {
    importButton.setAttribute("disabled", "");
    errorText.innerHTML = "";

    parent.postMessage(
      {
        pluginMessage: {
          type: "import-to-figma",
          token: tokenField.value,
          owner: ownerField.value,
          repo: repoField.value,
        },
      },
      "*"
    );
  };

  exportButton.onclick = async () => {
    exportButton.setAttribute("disabled", "");
    errorText.innerHTML = "";

    parent.postMessage(
      {
        pluginMessage: {
          type: "export-to-github",
          token: tokenField.value,
          owner: ownerField.value,
          repo: repoField.value,
        },
      },
      "*"
    );
  };

  window.onmessage = async (msg) => {
    const pluginMessage = msg.data.pluginMessage;
    console.log(pluginMessage);

    switch (pluginMessage.type) {
      case "import-to-figma":
        // TODO: handle error
        importButton.removeAttribute("disabled");
        break;

      case "export-to-github":
        // TODO: handle error
        exportButton.removeAttribute("disabled");
        break;

      default:
        console.warn("Unknown message:", pluginMessage);
        break;
    }
  };
</script>
